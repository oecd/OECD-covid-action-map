<doctype HTML>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<head>

	<link href="https://fonts.googleapis.com/css?family=Noto+Sans:400,400i,700,700i|Oswald:200,300,400,500,600,700&display=swap&subset=latin-ext" rel="stylesheet">
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="css/site.css">
<script src="https://code.jquery.com/jquery-3.5.0.js" integrity="sha256-r/AaFHrszJtwpe+tHyNi/XCfMxYpbsRg2Uqn0x3s2zc="
	crossorigin="anonymous"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
	 
<script src="libs/d3.v4.min.js"></script>
	<script src="libs/d3.v4.jetpack.min.js"></script>
	<script src="libs/d3-scale-chromatic.v1.min.js"></script>
	<script src="libs/topojson.v1.min.js"></script>
	<script src="libs/d3-queue.v3.min.js"></script>
	<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
	<script src="js/compChart.js"></script>
	<link rel="icon" href="img/favicon.ico" >
<script>

	dataLayer = [{

		"siteName": "oecd.github.io/OECD-covid-action-map",

		"siteEnvironment": "live",

		"pageLanguage": "en",         // or "en" or "es"

		"contentLanguage": "English",  // or "English" or "French"

		"pageTopic": "Coronavirus",

		"pageSubTopic": "",

		"pageCountry": "",

		"pageCategory": ""

	}];

</script>



<!-- Google Tag Manager -->

<script>(function (w, d, s, l, i) {
		w[l] = w[l] || []; w[l].push({
			'gtm.start':

				new Date().getTime(), event: 'gtm.js'
		}); var f = d.getElementsByTagName(s)[0],

			j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =

				'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);

	})(window, document, 'script', 'dataLayer', 'GTM-P5JSM4P');</script>

 <!--End Google Tag Manager -->
</head>

<body>

	<!-- Google Tag Manager (noscript) -->
	
	<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P5JSM4P" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
	
	<!--End Google Tag Manager (noscript) -->
	
	<!--<div id="warning">The country policy tracker will be available here <u>on March 30</u><Br/> <span id="warningtext">In the meantime, you can find OECD information on the impacts and consequences of the coronavirus pandemic on our lives and our societies at <a href="https://www.oecd.org/coronavirus">oecd.org/coronavirus</a></span></div>-->
	

	<!--</div>-->

	<h1>Country Policy Tracker</h1>
	<!--<div class="flex-container">
		<button class="button grey" id="Dimension" type="submit"
			value="Containment-measures__Confinement-and-lock-downs__Level" title="Housing" onclick="updateMap(value)"><span
				class="textbtn">Confinement and lock downs</span></button>
		<button class="button grey" id="Dimension" type="submit"
			value="Containment-measures__Travel-bans-and-restrictions__Level" title="Housing"
			onclick="updateMap(value)"><span class="textbtn">Travel bans and restrictions</span></button>
		<button class="button grey" id="Dimension" type="submit" value="Containment-measures__Closure-of-schools__Level"
			title="Housing" onclick="updateMap(value)"><span class="textbtn">Closure of schools</span></button>
		<button class="button grey" id="Dimension" type="submit"
			value="Containment-measures__Cancellation-of-public-events-Closure-of-public-places__Level" title="Housing"
			onclick="updateMap(value)"><span class="textbtn">Cancellation of public events/Closure of public
				places</span></button>
		<button class="button grey" id="Dimension" type="submit"
			value="Containment-measures__Obligatory-shut-down-of-economic-activities__Level" title="Housing"
			onclick="updateMap(value)"><span class="textbtn">Obligatory shut down of economic activities</span></button>
	</div>
	<div class="flex-container-legend" id="legendChoropleth">
		<div id="navigHeader">Level:</div>
		<div id="scaleLegend"></div>
		<div id="resetButton"><img id="resetcross" src="img/cross.svg"> <span id= resetText>Reset map &nbsp;</span></div>
	
	</div>-->
	<div id="aboutMap"></div>

	<div id="modedemploi">
		<div id="#intromodedemploi">Select a country:
		</div>
		<div id="selCountry">
			<select id="country_dropdown" onchange="updateCard(value)">
				<option value="-" selected="selected"> - </option>
			</select>
		</div>
	</div>
	
	<!--<div class="navigHeader">Policy responses by subject:</div>-->
	<!--<div class="flex-container" id="switchtracker">
		<button class="button green allData" id="allData" type="submit" value="allData"
			onclick="updateSelector(value),updateCircle(allData)"><span class="textbtn"><span class="greenbold">Visualise</span><br/>fiscal and monetary policy
				responses</span></button>
		<button class="button green alljobs" id="" type="submit" value="alljobs"
			onclick="updateSelector(value),updateCircle(alljobs)"><span class="textbtn"><span class="greenbold">Visualise</span><br />employment and social policy
				responses</span></button>-->
		<!--<button class="button green allhealth" id="" type="submit" value="allhealth" onclick="updateSelector(value),updateCircle(allhealth)"><span class="textbtn"><b>Visualise</b><br />health policy responses</span></button>
				<button class="button green alltax" id="" type="submit" value="alltax" onclick="updateSelector(value),updateCircle(alltax)"><span class="textbtn"><b>Visualise</b><br />tax policy responses</span></button>-->
	</div>
	
	<div class="flex-container" id="switchtracker">
		<div id="trackersNotes">
			<div id="updateTag">Beta version - last database update on <span id="date"></span></div>
			<div id="source">Download underlying data</div>
				<a class="toData" id="toEcoData" href="https://oecd.github.io/OECD-covid-action-map/data/CoronavirusUpdate_AllCountries_Public.xlsx" target="_blank">Fiscal and Monetary</a>
				<a class="toData" id="toElsData" href="http://www.oecd.org/social/Covid-19-Employment-and-Social-Policy-Responses-by-Country.xlsx" target="_blank">Employment and Social</a>
		
	<div id="copyright">Â© 2020 Organisation for Economic Co-operation and Development</div>
	</div>
	
		<div id="morebtn">
			<div class="toTrackers" id="toTrackersBtn">Download more policy responses</div>
		</div>
	</div>
	<div class="flex-container">
		<div id="disclaimer">This document, as well as any data and map included herein, are without prejudice to the status of or sovereignty over any territory, to the delimitation of international frontiers and boundaries and to the name of any territory, city or area.
		</div>
	</div>
		<div id="trackersLink">
			<div id="shutterholdertracker">
				<img id="shuttertracker" src="img/cross.svg">
		
				<div id="trackersText"><b>Find more country policy responses in these policy tracking initiatives:</b><Br />
					<ul>
						<li><a href="http://www.oecd.org/education/coronavirus-education-country-notes.htm" target="_blank">Education policy responses by country</a></li>
						<!--<li><a href="http://www.oecd.org/social/Covid-19-Employment-and-Social-Policy-Responses-by-Country.xlsx" target="_blank">Employment and social policy responses by country</a></li>-->
						<li><a href="http://www.oecd.org/health/COVID19-OECD-Health-System-Response-Tracker.xlsx" target="_blank">Health policy responses by country</a></li>
						<li><a href="https://stip.oecd.org/Covid.html" target="_blank">Science and innovation policy responses by country</a></li>
						<li><a href="http://www.oecd.org/chemicalsafety/pesticides-biocides/emergency-responses-for-the-supply-of-disinfectants-against-covid-19.htm" target="_blank">Supply of disinfectants against Covid-19 responses by country</a></li>
						<li><a href="http://www.oecd.org/tax/covid-19-tax-policy-and-other-measures.xlsm" target="_blank">Tax policy responses by country</a></li>
					</ul>
				</div>
			</div>
		</div>
	<div id="CountryCard">
			<div id="shutterholder" >
				<img id="shutter" src="img/cross.svg">
				<div id="countrySel"></div>
				<div id="betaTag">&nbsp;Beta</div>
					<div id="updateTime"></div>
				<div id="flex-container_comp">
					
				</div>
			</div>
			<div id="themebar"></div>
			<div id="navbar"></div>
			<Br />
			<div id="singleCountry"></div>
			<Br />
			<div id="noteCountry"></div>
	</div>


</body>
<script type="text/javascript">


	$(document).ready(function () {
		$('#country_dropdown').select2({ width: '180px' });
	});

	n = new Date();
	y = n.getFullYear();
	m = n.getMonth() + 1;
	d = n.getDate();
	document.getElementById("date").innerHTML = m + "/" + d + "/" + y;


	var limCouChart =15 //minimum number of countries to display on charts.


	var popupWidth;
	var heightChart ;
	var margin_chart
	var xScale;
	var yScale ;

	var selector = "allData";
	var selectorArray, selectorVariables; 
	var worldData, confinementdef, allcontext, allcontextvariables, allData, allVariables, alljobs, alljobsvariables;

	var allcircles=[];
	var country4card;

	var urls = {
	    world: "data/world.json",
	    country:"data/coord_country.tsv",
		context: "data/context.tsv",
		contextvariables: "data/contextvariables.tsv",
		actions:"data/actions.tsv",
		variables: "data/variables.tsv",
		jobs: "data/jobs.tsv",
		jobsvariables:"data/jobsvariables.tsv",
	};

	var divMap = d3.select("body").append("div") 
	    .attr("class", "tooltip")       
	    .style("opacity", 0);

    var format = d3.format(",.1f");
    var margin = 20,centered;

	var mapRatio=0.375;
    
    var width = document.getElementById("aboutMap").offsetWidth,
    	height= width*mapRatio;

	var quarantinecolor= d3.scaleOrdinal()
			.domain([-1,0, 1, 2, 3, 4, 5])
			.range(['#c0c7c9','#76fab7', '#73ce9e', '#6da485', '#647b6d', '#575456', '#482e40'])

	var circleColor=d3.scaleOrdinal()
			.domain(["alldata", "alljobs", "allhealth", "alltax"])
			.range(['#39617D', '#8cc841', '#8cc841', '#8cc841'])
			
  	var projection = d3.geoRobinson()
	    		.scale(width/7.75)
	    		.translate([width / 2, 6*height / 10])
  	        	.precision(.01);

  	var path = d3.geoPath()
                     .projection(projection);

  	var svg = d3.select("#aboutMap").append("svg")
  	    .attr("width", width)
  	    .attr("height", height)
 
    var worldMap=svg.append("g")

	var voronoiLayer = svg.append("g");

	var voronoi = d3.voronoi()
			.x(function (d) { return projection([d.lng, d.lat])[0]; })
			.y(function (d) { return projection([d.lng, d.lat])[1]; })
		.extent([[-1, -1], [width + 1, height + 1]]);
	
	var polygons;
	var polygonData;

	d3.queue()
	    .defer(d3.json, urls.world)
	    .defer(d3.tsv, urls.country)
		.defer(d3.tsv, urls.context)
		.defer(d3.tsv, urls.contextvariables)
		.defer(d3.tsv, urls.actions)
		.defer(d3.tsv, urls.variables)
		.defer(d3.tsv, urls.jobs)
		.defer(d3.tsv, urls.jobsvariables)
	    .await(render);

	var scalesvg = d3.select("#scaleLegend").append("svg")
		.attr("width", 250)
		.attr("height", 40)
	
		scalesvg.selectAll("rect").data([-1,0, 1, 2, 3, 4, 5])
				.enter().append("rect")
				.attr("class", function (d) { return "legend" + " value"+d;})
				.attr("height", 20)
				.attr("x", function (d) { return 5+(d+1)*35; })
				.attr("width", function (d) { return 30; })
				.style("fill", function (d) { return quarantinecolor(d); });
		scalesvg.selectAll("text").data([0, 1, 2, 3, 4, 5])
				.enter().append("text")
				.attr("class", function (d) { return "legendtext" + " textvalue"+d;})
				.attr("y", 35)
				.attr("x", function (d) { return 17.5 + (d + 1)* 35; })
				//.attr("width", function (d) { return 10; })
				.text( function (d) { return d; });

	d3.tsv("data/confinement.tsv",function(data){
		confinementdef=data;
	})		

	function setDropdown(data){
		document.getElementById("country_dropdown").innerHTML = "<option value=\"-\" selected=\"selected\"> - </option>";
	data.forEach(function(d){
		
		var x = document.getElementById("country_dropdown");
		
		var option = document.createElement("option");
		option.value = d.values[0].ISO3;
		option.innerHTML = d.key;

		x.appendChild(option);



	
	})
}

	function render(err,world,country, context, contextvariables, actions,variables,jobs,jobsvariables){

		worldData=world;
		allcontext= context;
		allcontextvariables= contextvariables;
		allData=actions;
		allVariables=variables;
		alljobs= jobs;
		alljobsvariables= jobsvariables;

		//Container for the gradients //https://www.visualcinnamon.com/2016/06/glow-filter-d3-visualization.html
		var defs = worldMap.append("defs");

		//Filter for the outside glow
		var filter = defs.append("filter")
		    .attr("id","glow");
		filter.append("feGaussianBlur")
		    .attr("stdDeviation","1.75")
		    .attr("result","coloredBlur");
		var feMerge = filter.append("feMerge");
		feMerge.append("feMergeNode")
		    .attr("in","coloredBlur");
		feMerge.append("feMergeNode")
		    .attr("in","SourceGraphic");

	    worldMap
	    	.attr("id","world")
	    	.selectAll("path")
	        .data(world.features)
	      	.enter().append("path")
	        .attr("class","world")
			.attr('fill', function(d){
				var value= "#c0c7c9";
				/*actions.forEach(function(k){
					if(k.ISO3== d.properties.ISO3_CODE){
						value = quarantinecolor(k['Containment-measures__Confinement-and-lock-downs__Level'])
					}
				})*/
				return value;
			})
			.attr('stroke', "#c0c7c9")
			.attr("d", path)
			
		var currentURL = window.location.href;

			if(currentURL.split("?")[1]=="alljobs"){
				updateSelector(currentURL.split("?")[1]);
//				updateCircle(alljobs)
				

				var button2update = "." + currentURL.split("?")[1];
				d3.selectAll(".green").style("background", "#548235")
				d3.selectAll(button2update).style("background", "#0b1e2d")

				if (currentURL.split("?")[2] != "")
					updateCard(currentURL.split("?")[2])

			}
			else if (currentURL.split("?")[1] == "allhealth") {

				updateSelector(currentURL.split("?")[1]);
//				updateCircle(allhealth)

				var button2update = "." + currentURL.split("?")[1];
				d3.selectAll(".green").style("background", "#548235")
				d3.selectAll(button2update).style("background", "#0b1e2d")
			}
			else if (currentURL.split("?")[1] == "alltax") {

				updateSelector(currentURL.split("?")[1]);
//				updateCircle(alltax)

				var button2update = "." + currentURL.split("?")[1];
				d3.selectAll(".green").style("background", "#548235")
				d3.selectAll(button2update).style("background", "#0b1e2d")
			
			}//else{
				///////////////////////////////
				///////////////////////////////
				//TO COMPLETE WITHTRACKERS/////
				///////////////////////////////
				///////////////////////////////
				actions.forEach(function(d){
					var circles2add=true;
					allcircles.forEach(function (k){
						if(k.ISO3==d.ISO3)
							circles2add=false;
					})
					if(circles2add)
						allcircles.push({ "ISO3":d.ISO3	,"lat": d.lat	,"lng":	d.lng,"Country": d.Country	})
				})

				actions.forEach(function (d) {
					var circles2add=true;
					allcircles.forEach(function (k) {
						if (k.ISO3 == d.ISO3)
							circles2add = false;
					})
					if (circles2add)
						allcircles.push({ "ISO3": d.ISO3, "lat": d.lat, "lng": d.lng, "Country": d.Country })
				})


				//updateCircle(allData);
				updateCircle(allcircles);
			//}
	};	  

	function updateCircle(selData){

		if (selData===undefined){

		}else{
				var countryList = d3.nest()
					.key(function (d) { return d.Country; }).sortKeys(d3.ascending)
					.entries(selData);

				setDropdown(countryList);
		}

		worldMap.selectAll(".couCircle").remove();

		voronoiLayer.selectAll(".cell").remove();
		
		worldMap
			.selectAll(".couCircle")
			.data(selData)
			.enter().append("circle").attr("class", "couCircle")
			.attr("id", function (d) { return d.ISO3 + "circle"; })
			.attr("cx", function (d) {
				return projection([d.lng, d.lat])[0];
			})
			.attr("cy", function (d) {
				return projection([d.lng, d.lat])[1];
			})
			.attr("r", function (d) {
				if (d.ISO3 == "EU" || d.ISO3 == "SEA")
					return width / 250;
				else
					return width / 375;
			})
			.attr("fill", function (d) {
				if (d.ISO3 == "EU" || d.ISO3 == "SEA")
					return "#17a2b8";
				else
					return "#04629a";//circleColor(selector);//;
			})

		polygonData=selData;
		polygons = voronoi(polygonData).polygons();

		voronoiLayer.selectAll(".cell")
			.data(polygons)
			.enter()
			.append("path")
			.attr("class", "cell")
			.attr("fill", "none")
			.style("pointer-events", "all")
			.attr("stroke", "none")
			.attr("d", function (d) { return "M" + d.join("L") + "Z"; })
			.on('mouseover', function (d) {
				d3.select("#" + d.data.ISO3+"circle").attr("fill","#e73741")

				divMap.transition()
					.duration(250)
					.style("opacity", 1);
				
				var htmlText = "<b>" + d.data.Country + "</b>";
				divMap.html(htmlText)
					.style("left", event.pageX - document.body.scrollLeft + "px")
					.style("top", event.pageY - document.body.scrollTop + "px");

				})
			
			.on("mousemove", function (d) {

				divMap
					.style("left", event.pageX - document.body.scrollLeft + 10 + "px")
					.style("top", event.pageY - document.body.scrollTop + "px");

			})
			.on('mouseout', function (d) {
				
				if (d.data.ISO3 == "EU" || d.data.ISO3 == "SEA")
					d3.select("#" + d.data.ISO3 + "circle").attr("fill",  "#17a2b8");
				else
					d3.select("#" + d.data.ISO3 + "circle").attr("fill",  "#04629a"/*circleColor(selector)*/);
			
				divMap.transition()
					.duration(100)
					.style("opacity", 0);
			})
			.on('click',function(d){
				updateCard(d.data.ISO3)
			});
			
	};
      


	function resize() {
		// adjust things when the window size changes
		width = document.getElementById("aboutMap").offsetWidth,
			height = width * mapRatio;

		// update projection
		projection
			.translate([width / 2, 6 * height / 10])
			.scale(width / 7.75);

		// resize the map container
		svg.attr('width', width + 'px')
			.attr('height', height + 'px');

		// resize the map
		worldMap.selectAll('.world').attr('d', path);
		//world.selectAll('.state').attr('d', path);


		worldMap.selectAll('circle')
			.attr("cx", function (d) {
				return projection([d.lng, d.lat])[0];
			})
			.attr("cy", function (d) {
				return projection([d.lng, d.lat])[1];
			})
			.attr("r", width / 300);

		voronoi
			.extent([[-1, -1], [width + 1, height + 1]]);

		polygons = voronoi(polygonData).polygons();

		voronoiLayer.selectAll(".cell")
			.data(polygons)
			.attr("fill", "none")
			.style("pointer-events", "all")
			.attr("stroke", "none")
			.attr("d", function (d) { return "M" + d.join("L") + "Z"; })
	}



	function updateCard(couCode){

				///////////////////////////////
				///////////////////////////////
				//TO COMPLETE WITHTRACKERS/////
				///////////////////////////////
				///////////////////////////////
		selectorArray=[allData, alljobs, allcontext]	
		selectorVariables = [allVariables, alljobsvariables, allcontextvariables]	
	
		var selData,selVariables;
		if(selector=="allData"){
			if(allData.map(function (d) { return d.ISO3 }).indexOf(couCode) > -1){
				selData = allData;
				selVariables = allVariables;
			}
			else{
				for (i=0;i<selectorArray.length;i++){
					if (selectorArray[i].map(function (d) { return d.ISO3 }).indexOf(couCode) > -1) {
						selData = selectorArray[i];
						selVariables = selectorVariables[i];

						break
					}
				}
			}
		}
		else if (selector == "allcontext") {
			if (allcontext.map(function (d) { return d.ISO3 }).indexOf(couCode) > -1) {
				selData = allcontext;
				selVariables = allcontextvariables;
			}
			else {
				for (i = 0; i < selectorArray.length; i++) {
					if (selectorArray[i].map(function (d) { return d.ISO3 }).indexOf(couCode) > -1) {
						selData = selectorArray[i];
						selVariables = selectorVariables[i];

						break
					}
				}
			}
		}
		else if (selector == "alljobs") {
			if (alljobs.map(function (d) { return d.ISO3 }).indexOf(couCode) > -1) {
				selData =alljobs;
				selVariables =alljobsvariables;
			}
			else {
				for (i = 0; i < selectorArray.length; i++) {
					if (selectorArray[i].map(function (d) { return d.ISO3 }).indexOf(couCode) > -1) {
						selData = selectorArray[i];
						selVariables = selectorVariables[i];

						break
					}
				}
			}
		}
		else if (selector == "allhealth"){
			if (allhealth.map(function (d) { return d.ISO3 }).indexOf(couCode) > -1) {
				selData = allhealth;
				selVariables = allhealthvariables;
			}
			else {
				for (i = 0; i < selectorArray.length; i++) {
					if (selectorArray[i].map(function (d) { return d.ISO3 }).indexOf(couCode) > -1) {
						selData = selectorArray[i];
						selVariables = selectorVariables[i];

						break
					}
				}
			}
		}
		else if (selector == "alltax"){
			if (alltax.map(function (d) { return d.ISO3 }).indexOf(couCode) > -1) {
				selData = alltax;
				selVariables = alltaxvariables;
			}
			else {
				for (i = 0; i < selectorArray.length; i++) {
					if (selectorArray[i].map(function (d) { return d.ISO3 }).indexOf(couCode) > -1) {
						selData = selectorArray[i];
						selVariables = selectorVariables[i];

						break
					}
				}
			}
		}
		
		var temp= selData.filter(function (d) { return d.ISO3 == couCode })
		
		document.getElementById("CountryCard").style.display = 'block';

		document.getElementById("countrySel").innerHTML = temp[0].Country;

		document.getElementById("updateTime").innerHTML = "Country data updated on " + temp[0].update;
		
		var navText="";
		
		var countryText="";
		var themenav="";

		function isPresent(fruit) {
			return fruit.ISO3 === couCode;
		}

		country4card=couCode;
		
		//if(allcontext.find(isPresent)) // replaced as find not read in explorer
		if (typeof allcontext.filter(function (x) { return x.ISO3 === couCode })[0] !== "undefined")
			var themenav = "<button class=\"button menuCard allcontext\"  type=\"submit\" value=\"allcontext\" onclick = \"updateSelector(value),/*updateCircle(allcontext),*\/updateCard(country4card)\" >Context</button >";

		//if(allData.find(isPresent))
		if (typeof allData.filter(function (x) { return x.ISO3 === couCode })[0] !== "undefined")
			var themenav = themenav + "<button class=\"button menuCard allData\"  type=\"submit\" value=\"allData\" onclick = \"updateSelector(value),/*updateCircle(allData),*\/updateCard(country4card)\" >Fiscal and Monetary</button >";

		//if (alljobs.find(isPresent)) // does not work with explorer
		if (typeof alljobs.filter(function (x) { return x.ISO3 === couCode })[0] !== "undefined")
			var themenav = themenav + "<button class=\"button menuCard alljobs\"  type=\"submit\" value=\"alljobs\" onclick = \"updateSelector(value),/*updateCircle(alljobs),*\/updateCard(country4card)\" >Employment and Social</button >";


		selVariables.forEach(function(d){
				if (d.level== "SectionTitle"){
					var count = 0; 
					selVariables.filter(function (k) { return k.hierarchy.split("-")[0] == d.hierarchy.split("-")[0] && k.hierarchy.split("-")[2]  == "text"}).forEach(function (k) {
						
							if (!(temp[0][k.code] == "" || temp[0][k.code] == "Information not available")) {
								count++;
							}
						

					})

					if (count >0){
						
						countryText = countryText + "<div class=\"border\" id=\"" + d.title.replace(/ /g, "") + "\" ><span class=\"SectionTitle\">" + d.title + "</span></div><Br/>"
						navText = navText + "<a class=\"couNav\" href=\"#" + d.title.replace(/ /g, "") + "\">" + d.title + "</a><Br/>"
						
						selVariables.filter(function (k) { return (k.hierarchy.split("-")[0] == d.hierarchy.split("-")[0]) && k.hierarchy.split("-")[1]!= undefined }).forEach(function (k) {
							if (k.level == "SectionText" || k.level == "choroplethDesc") {
								if(k.level == "choroplethDesc"){
									if (!(temp[0][k.code] == "" || temp[0][k.code] == "Information not available")){
										console.log(k.code.replace("__Description", "__Level"))
										countryText = countryText + "<div  class=\"SectionText\"><b>" + k.title + "</b>"+/**"<span class=\"levelValue\">(level: "+ temp[0][k.code.replace("__Description", "__Level")]+")</span>"+**/"<br/>" + temp[0][k.code] + "</div><Br/>";

									}
								}else{
									if (!(temp[0][k.code] == "" || temp[0][k.code] == "Information not available"))
										countryText = countryText + "<div  class=\"SectionText\"><b>" + k.title + "</b><br/>" + temp[0][k.code] + "</div><Br/>";
	
								}
							}/* else if (k.level == "SectionChart") {
								if (!(temp[0][k.code] == "" || temp[0][k.code] == "Information not available" ))
									countryText = countryText + "<div class=\"SectionChart\" id =\"" + k.code + "_Label\"><b>" + k.title + "</b> - <i>" + k.unit + "</i></div><br/><div class=\"SectionChart\" id=\"" + k.code + "\"></div><Br/>";
							} else if (k.level == "SectionEmbed") {
							if (!(temp[0][k.code] == "" || temp[0][k.code] == "Information not available"))
								countryText = countryText + "<div class=\"SectionEmbed\"><b>" + k.title + "</b> - <i>" + k.unit + "</i></div><br/>" + temp[0][k.code] + "<Br/>";
							}*/
						})
					}
				}	
				
		})

		document.getElementById("themebar").innerHTML = themenav;
		document.getElementById("navbar").innerHTML = navText;
		document.getElementById("singleCountry").innerHTML= countryText


		var elmnt = document.getElementById("themebar");
		elmnt.scrollIntoView(false);

		var button2update="."+selector;
		d3.selectAll(".green").style("background","#548235")
		d3.selectAll(button2update).style("background","#0b1e2d")

		if (couCode == "XKX")
				document.getElementById("noteCountry").innerHTML = "<b>Note on Kosovo</b>: This designation is without prejudice to positions on status, and is in line with United Nations Security Council Resolution 1244/99 and the Advisory Opinion of the International Court of Justice on Kosovo's declaration of independence."
		else if (couCode == "ISR")
				document.getElementById("noteCountry").innerHTML = "<b>Note on Israel</b>: The statistical data for Israel are supplied by and under the responsibility of the relevant Israeli authorities. The use of such data by the OECD is without prejudice to the status of the Golan Heights, East Jerusalem and Israeli settlements in the West Bank under the terms of international law."
		else
				document.getElementById("noteCountry").innerHTML = ""

		/*selVariables.forEach(function (d) {
			if (d.level == "SectionChart" && (selData.filter(function (k) { return k[d.code] != "--" && k[d.code] != "Information not available" && k[d.code] != "null" && k[d.code] != "" && !(isNaN(k[d.code])) }).length> limCouChart)) {
				compChart(selData,d.code)	
				highlight(couCode, selData.filter(function (k) { return k[d.code] != "--" && k[d.code] != "Information not available" && k[d.code] != "null" && k[d.code] != "" && !(isNaN(k[d.code]) )}).length,d.code)				
			} else if(d.level == "SectionChart" && (selData.filter(function (k) { return k[d.code] != "--" && k[d.code] != "Information not available" && k[d.code] != "null" && k[d.code] != "" && !(isNaN(k[d.code])) }).length <= limCouChart)) {
				var div2hide=d.code+"_Label"
				document.getElementById(div2hide).innerHTML = "";
			} 
		})*/

	}


	function updateSelector(string){
		selector=string;
	}

	function updateMap(value){
		if (value=="Containment-measures__Cancellation-of-public-events-Closure-of-public-places__Level"){
			scalesvg.select(".value4")
				.style("opacity", 0)

			scalesvg.select(".value5")
				.style("opacity", 0)

			scalesvg.select(".textvalue4")
				.style("opacity", 0)

			scalesvg.select(".textvalue5")
				.style("opacity", 0)
		} else {
			scalesvg.select(".value4")
				.style("opacity", 1)

			scalesvg.select(".value5")
				.style("opacity", 1)
			
			scalesvg.select(".textvalue4")
				.style("opacity", 1)

			scalesvg.select(".textvalue5")
				.style("opacity", 1)
		}

	scalesvg.selectAll("rect")
		.on("mouseover",function(d){
			for(i=-1;i<=5;i++){
				if(i!=d){
					var cathighlight=".cat"+i;
					worldMap
						.selectAll(cathighlight)
						.style("opacity", 0.2)
				}
				
			}
			
			var htmlText;
			
			confinementdef.forEach(function(k){
				
				if(k.level==d && k.code==value)
					htmlText = k.definition
		
			});
			if (d=="-1")
			htmlText="Not available";
			divMap.html(htmlText)
				.style("left", event.pageX - document.body.scrollLeft + 10 + "px")
				.style("top", event.pageY - document.body.scrollTop + "px");

			divMap.transition()
				.duration(250)
				.style("opacity", 1);

		})
		.on("mousemove",function(d){

			divMap
				.style("left", event.pageX - document.body.scrollLeft + 10 + "px")
				.style("top", event.pageY - document.body.scrollTop + "px");

		})
		.on("mouseout",function(d){
			worldMap
				.selectAll("path")
				.style("opacity", 0.75)
			
			divMap.transition()
				.duration(100)
				.style("opacity", 0);

		}) 

	document.getElementById("legendChoropleth").style.visibility = 'visible';
	document.getElementById("resetButton").style.visibility = 'visible';
	
	worldMap
		.selectAll("path")
		.data(worldData.features)
		.transition().duration(500)
		.attr("class", function (k) {
			var catvalue = "-1";
			allData.forEach(function (j) {
				if (j.ISO3 == k.properties.ISO3_CODE) {
					if (j[value] != 'Information not available' && j[value] != '')
						catvalue = j[value] 
				}
			})
			return "world cat"+ catvalue;
		})
		
		.attr('fill', function (d) {
			
			var basecolor = "#c0c7c9";
			allData.forEach(function (k) {
				if (k.ISO3 == d.properties.ISO3_CODE) {
					if (k[value]!='Information not available' && k[value]!= '')
						basecolor = quarantinecolor(k[value])
				}
			})
			return basecolor;
		})
		.style("opacity",0.75)

	voronoiLayer.selectAll(".cell")
	
		.on('mouseover', function (d) {

			var variable= value.replace(/__Level/g,"")+"__Description";
			//var element = d3.select("#" + d.data.ISO3 + "circle")

			d3.select("#" + d.data.ISO3 + "circle").attr("fill", "#e73741")

			divMap.transition()
				.duration(250)
				.style("opacity", 1);

			var icuText;
			var tempVariable
			allData.forEach(function(k){
				if(d.data.ISO3==k.ISO3)
					tempVariable=k;
			})
			
			if (tempVariable[value] == 'Information not available' || tempVariable[value] == '')
				icuText = ""
			else
				icuText = "<br/><b>Level: " + tempVariable[value] + "</b><Br/>"+ tempVariable[variable];

			var htmlText = "<b>" + tempVariable.Country + "</b>"+   icuText;

			divMap.html(htmlText)
				.style("left", event.pageX - document.body.scrollLeft + "px")
				.style("top", event.pageY - document.body.scrollTop + "px");

		})

		.on("mousemove", function (d) {

			divMap
				.style("left", event.pageX - document.body.scrollLeft + 10 + "px")
				.style("top", event.pageY - document.body.scrollTop + "px");

		})
		.on('mouseout', function (d) {

			if (d.data.ISO3 == "EU" || d.data.ISO3 == "SEA")
				d3.select("#" + d.data.ISO3 + "circle").attr("fill", "#17a2b8");
			else
				d3.select("#" + d.data.ISO3 + "circle").attr("fill", "#04629a"/*circleColor(selector)*/);

			divMap.transition()
				.duration(100)
				.style("opacity", 0);
		})
		.on('click', function (d) {
			updateCard(d.data.ISO3)
		});
		
}


	d3.select(window).on('resize', resize);

	d3.select("#shutter")
	.on("mouseover",function(){
		d3.select(this).style("opacity",0.5);
	})
	.on("mouseout", function () {
			d3.select(this).style("opacity", 1);
	})
	.on("click",function(){
		document.getElementById("CountryCard").style.display = 'none';

	//	document.getElementById("country_dropdown").value = '-';
		$('#country_dropdown').select2().select2('val', '-');
		//document.getElementById("modedemploi").style.display = 'block';
	})


	d3.select("#shuttertracker")
		.on("mouseover", function () {
			d3.select(this).style("opacity", 0.5);
		})
		.on("mouseout", function () {
			d3.select(this).style("opacity", 1);
		})
		.on("click", function () {

			document.getElementById("trackersLink").style.display = 'none';
		})
    
		d3.select("#toTrackersBtn")
				.on("click", function () {
					document.getElementById("trackersLink").style.display = 'block';
				})

	d3.selectAll(".button.grey")
		.on("click", function () {
			d3.selectAll(".button.grey")
				.style("background-color", "#ffffff").style("color","#0b1e2d")
			d3.select(this)
				.style("background-color", "#04629a").style("color", "#ffffff")
		})

	d3.selectAll(".button.green")
		.on("click", function () {
			d3.selectAll(".button.green")
				.style("background-color", "#548235")
			d3.select(this)
				.style("background-color", "#0b1e2d")
		})


	d3.select("#resetButton")
	.on('click',function(){
		worldMap
			.selectAll("path")
			.attr('fill', "#c0c7c9")
			.style("opacity", 0.75)

		document.getElementById("legendChoropleth").style.visibility = 'hidden';
		document.getElementById("resetButton").style.visibility = 'hidden';

		d3.selectAll(".grey")
			.style("background-color", "#ffffff").style("color", "#0b1e2d")
	
			

		voronoiLayer.selectAll(".cell")

			.on('mouseover', function (d) {

				
				d3.select("#" + d.data.ISO3 + "circle").attr("fill", "#e73741")

				divMap.transition()
					.duration(250)
					.style("opacity", 1);

				var htmlText = "<b>" + d.data.Country + "</b>" 

				divMap.html(htmlText)
					.style("left", event.pageX - document.body.scrollLeft + "px")
					.style("top", event.pageY - document.body.scrollTop + "px");

			})

			.on("mousemove", function (d) {

				divMap
					.style("left", event.pageX - document.body.scrollLeft + 10 + "px")
					.style("top", event.pageY - document.body.scrollTop + "px");

			})
			.on('mouseout', function (d) {

				if (d.data.ISO3 == "EU" || d.data.ISO3 == "SEA")
					d3.select("#" + d.data.ISO3 + "circle").attr("fill", "#17a2b8");
				else
					d3.select("#" + d.data.ISO3 + "circle").attr("fill", "#04629a"/*circleColor(selector)*/);

				divMap.transition()
					.duration(100)
					.style("opacity", 0);
			})
			.on('click', function (d) {
				updateCard(d.data.ISO3)
			});
	})




</script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-51983915-1', 'auto');
  ga('send', 'pageview');

</script>
